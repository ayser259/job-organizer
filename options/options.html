<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save to Tracker Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 100 100" fill="none">
          <path d="M6.017 4.313l55.333 -4.087c6.797 -0.583 8.543 -0.19 12.817 2.917l17.663 12.443c2.913 2.14 3.883 2.723 3.883 5.053v68.243c0 4.277 -1.553 6.807 -6.99 7.193L24.467 99.967c-4.08 0.193 -6.023 -0.39 -8.16 -3.113L3.3 79.94c-2.333 -3.113 -3.3 -5.443 -3.3 -8.167V11.113c0 -3.497 1.553 -6.413 6.017 -6.8z" fill="#fff"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M61.35 0.227l-55.333 4.087C1.553 4.7 0 7.617 0 11.113v60.66c0 2.723 0.967 5.053 3.3 8.167l13.007 16.913c2.137 2.723 4.08 3.307 8.16 3.113l64.257 -3.89c5.433 -0.387 6.99 -2.917 6.99 -7.193V20.64c0 -2.21 -0.873 -2.847 -3.443 -4.733L74.167 3.143c-4.273 -3.107 -6.02 -3.5 -12.817 -2.917zM25.92 19.523c-5.247 0.353 -6.437 0.433 -9.417 -1.99L8.927 11.507c-0.77 -0.78 -0.383 -1.753 1.557 -1.947l53.193 -3.887c4.467 -0.39 6.793 1.167 8.54 2.527l9.123 6.61c0.39 0.197 1.36 1.36 0.193 1.36l-54.933 3.307 -0.68 0.047zM19.803 88.3V30.367c0 -2.53 0.777 -3.697 3.103 -3.893L86 22.78c2.14 -0.193 3.107 1.167 3.107 3.693v57.547c0 2.53 -0.39 4.67 -3.883 4.863l-60.377 3.5c-3.493 0.193 -5.043 -0.97 -5.043 -4.083zm59.6 -54.827c0.387 1.75 0 3.5 -1.75 3.7l-2.91 0.577v42.773c-2.527 1.36 -4.853 2.137 -6.797 2.137 -3.107 0 -3.883 -0.973 -6.21 -3.887l-19.03 -29.94v28.967l6.02 1.363s0 3.5 -4.857 3.5l-13.39 0.777c-0.39 -0.78 0 -2.723 1.357 -3.11l3.497 -0.97v-38.3L30.48 40.667c-0.39 -1.75 0.58 -4.277 3.3 -4.473l14.367 -0.967 19.8 30.327v-26.83l-5.047 -0.58c-0.39 -2.143 1.163 -3.7 3.103 -3.89l13.4 -0.78z" fill="#000"/>
        </svg>
        <div class="logo-text">
          <h1>Save to Tracker</h1>
          <p>Configuration</p>
        </div>
      </div>
    </header>

    <main class="main">
      <form id="settingsForm" class="form">
        <!-- Integration Secret -->
        <div class="form-section">
          <div class="form-group">
            <label class="form-label" for="notionSecret">
              Integration Secret
              <span class="required">*</span>
            </label>
            <p class="form-hint">
              Your Notion internal integration token. Find it in your 
              <a href="https://www.notion.so/my-integrations" target="_blank">integration settings</a>.
            </p>
            <div class="input-wrapper">
              <input 
                type="password" 
                id="notionSecret" 
                name="notionSecret" 
                class="form-input" 
                placeholder="secret_xxxxxxxxxxxxxxxxxxxx"
                required
                autocomplete="off"
              >
              <button type="button" class="toggle-visibility" id="toggleSecret" title="Show/Hide">
                <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="eye-closed hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Database ID -->
        <div class="form-section">
          <div class="form-group">
            <label class="form-label" for="databaseId">
              Database ID
              <span class="required">*</span>
            </label>
            <p class="form-hint">
              The ID of your target Notion database. You can find this in the database URL: 
              <code>notion.so/&lt;workspace&gt;/<strong>&lt;database_id&gt;</strong>?v=...</code>
            </p>
            <input 
              type="text" 
              id="databaseId" 
              name="databaseId" 
              class="form-input" 
              placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
              required
              autocomplete="off"
            >
          </div>
        </div>

        <!-- Google Sheets Section -->
        <div class="form-section sheets-section">
          <div class="section-header">
            <div class="section-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="3" y1="15" x2="21" y2="15"></line>
                <line x1="9" y1="3" x2="9" y2="21"></line>
                <line x1="15" y1="3" x2="15" y2="21"></line>
              </svg>
              <span>Google Sheets Sync</span>
              <span class="badge optional">Optional</span>
            </div>
            <p class="section-desc">Automatically sync data to Google Sheets for easy analysis</p>
          </div>

          <!-- Enable Toggle -->
          <div class="form-group">
            <label class="toggle-label">
              <input type="checkbox" id="sheetsEnabled" class="toggle-checkbox">
              <span class="toggle-switch"></span>
              <span class="toggle-text">Enable Google Sheets sync</span>
            </label>
          </div>
          
          <div id="sheetsConfig" class="sheets-config hidden">
            <div class="form-group">
              <label class="form-label" for="sheetsApiKey">
                Google API Key
              </label>
              <p class="form-hint">
                <strong>How to get your API key:</strong><br>
                1. Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a><br>
                2. Create a new project (or select existing)<br>
                3. Search for "Google Sheets API" in the search bar and click "Enable"<br>
                4. Go to "Credentials" in the left sidebar<br>
                5. Click "Create Credentials" â†’ "API Key"<br>
                6. Copy the key (starts with <code>AIza</code>) and paste it below
              </p>
              <div class="input-wrapper">
                <input 
                  type="password" 
                  id="sheetsApiKey" 
                  name="sheetsApiKey" 
                  class="form-input" 
                  placeholder="AIzaSyxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                  autocomplete="off"
                >
                <button type="button" class="toggle-visibility" id="toggleSheets" title="Show/Hide">
                  <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="eye-closed hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" for="spreadsheetId">
                Spreadsheet ID
              </label>
              <p class="form-hint">
                The ID from your spreadsheet URL: 
                <code>docs.google.com/spreadsheets/d/<strong>&lt;spreadsheet_id&gt;</strong>/edit</code>
              </p>
              <input 
                type="text" 
                id="spreadsheetId" 
                name="spreadsheetId" 
                class="form-input" 
                placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                autocomplete="off"
              >
            </div>

            <div class="form-group">
              <label class="form-label" for="sheetName">
                Sheet Name
              </label>
              <p class="form-hint">
                The name of the sheet tab (default: "Sheet1")
              </p>
              <input 
                type="text" 
                id="sheetName" 
                name="sheetName" 
                class="form-input" 
                placeholder="Sheet1"
                autocomplete="off"
              >
            </div>

            <!-- Sheets Status -->
            <div class="sheets-status" id="sheetsStatus">
              <div class="status-indicator">
                <span class="status-dot" id="sheetsDot"></span>
                <span class="status-text" id="sheetsStatusText">Not configured</span>
              </div>
            </div>
          </div>
        </div>

        <!-- OpenAI Section -->
        <div class="form-section openai-section">
          <div class="section-header">
            <div class="section-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/>
                <circle cx="8" cy="14" r="1"/>
                <circle cx="16" cy="14" r="1"/>
              </svg>
              <span>AI Auto-Fill</span>
              <span class="badge optional">Optional</span>
            </div>
            <p class="section-desc">Enable AI-powered form filling using OpenAI</p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="openaiApiKey">
              OpenAI API Key
            </label>
            <p class="form-hint">
              Your OpenAI API key for AI-powered auto-fill. Get one at 
              <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com/api-keys</a>
            </p>
            <div class="input-wrapper">
              <input 
                type="password" 
                id="openaiApiKey" 
                name="openaiApiKey" 
                class="form-input" 
                placeholder="sk-xxxxxxxxxxxxxxxxxxxx"
                autocomplete="off"
              >
              <button type="button" class="toggle-visibility" id="toggleOpenAI" title="Show/Hide">
                <svg class="eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <svg class="eye-closed hidden" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </button>
            </div>
          </div>

          <!-- OpenAI Status -->
          <div class="openai-status" id="openaiStatus">
            <div class="status-indicator">
              <span class="status-dot" id="openaiDot"></span>
              <span class="status-text" id="openaiStatusText">Not configured</span>
            </div>
          </div>
        </div>

        <!-- Connection Status -->
        <div class="form-section">
          <div class="status-card" id="statusCard">
            <div class="status-indicator" id="statusIndicator">
              <span class="status-dot"></span>
              <span class="status-text">Not connected</span>
            </div>
            <div class="status-details hidden" id="statusDetails">
              <div class="database-info">
                <span class="db-icon">ðŸ“Š</span>
                <span class="db-name" id="connectedDbName"></span>
              </div>
              <div class="property-count" id="propertyCount"></div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="testBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            Test Connection
          </button>
          <button type="submit" class="btn btn-primary" id="saveBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            Save Settings
          </button>
        </div>
      </form>

      <!-- Help Section -->
      <section class="help-section">
        <h2>Setup Instructions</h2>
        
        <h3>Notion Setup (Required)</h3>
        <ol class="setup-steps">
          <li>
            <strong>Create an Integration</strong>
            <p>Go to <a href="https://www.notion.so/my-integrations" target="_blank">notion.so/my-integrations</a> and create a new internal integration.</p>
          </li>
          <li>
            <strong>Copy the Integration Secret</strong>
            <p>After creating the integration, copy the "Internal Integration Secret" and paste it above.</p>
          </li>
          <li>
            <strong>Share Your Database</strong>
            <p>Open your target database in Notion, click "..." â†’ "Add connections" â†’ Select your integration.</p>
          </li>
          <li>
            <strong>Copy the Database ID</strong>
            <p>From your database URL, copy the 32-character ID before the <code>?v=</code> parameter.</p>
          </li>
        </ol>

        <h3>Google Sheets Setup (Optional)</h3>
        <ol class="setup-steps">
          <li>
            <strong>Create a Google Cloud Project</strong>
            <p>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>. Click "Select a project" at the top, then "New Project". Give it a name (e.g., "Notion Clipper") and click "Create".</p>
          </li>
          <li>
            <strong>Enable Google Sheets API</strong>
            <p>In the search bar at the top, type "Google Sheets API". Click on it, then click the blue "Enable" button. Wait for it to finish enabling.</p>
          </li>
          <li>
            <strong>Create an API Key</strong>
            <p>Click "Credentials" in the left sidebar. Click "Create Credentials" at the top, then select "API Key". A popup will show your new API key - click "Copy" to copy it. The key starts with <code>AIza</code>.</p>
          </li>
          <li>
            <strong>Prepare Your Spreadsheet</strong>
            <p>Create a new Google Sheets spreadsheet. In row 1, add column headers that match your Notion property names <strong>exactly</strong>. For example, if your Notion has properties named "Title", "URL", "Company", "Status", then your Sheet row 1 should be:</p>
            <p style="margin: 8px 0; padding: 8px; background: var(--bg-tertiary); border-radius: 4px; font-family: var(--font-mono); font-size: 12px;">
              <strong>A1:</strong> Title &nbsp; <strong>B1:</strong> URL &nbsp; <strong>C1:</strong> Company &nbsp; <strong>D1:</strong> Status
            </p>
            <p><strong>Important:</strong> Click "Share" button and set to "Anyone with the link can view" (or "can edit").</p>
          </li>
          <li>
            <strong>Get Spreadsheet ID</strong>
            <p>Look at your spreadsheet URL. It looks like: <code>docs.google.com/spreadsheets/d/<strong>1BxiMVs0XRA5nFMd...</strong>/edit</code><br>Copy the long ID between <code>/d/</code> and <code>/edit</code>.</p>
          </li>
          <li>
            <strong>Configure the Extension</strong>
            <p>Return to this page. Toggle "Enable Google Sheets sync" to ON. Paste your API key, Spreadsheet ID, and enter the sheet tab name (usually "Sheet1"). Click "Save Settings" at the bottom.</p>
          </li>
        </ol>
        
        <div class="help-note">
          <strong>ðŸ’¡ Pro Tip:</strong> If you get errors about "API not enabled", make sure you enabled the Google Sheets API in step 2 and waited for it to fully activate (can take 1-2 minutes).
        </div>
      </section>
    </main>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
      <span class="toast-icon"></span>
      <span class="toast-message"></span>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html>

